---
// src/pages/index.astro
import { ClientRouter } from 'astro:transitions';
import { supabase } from "../lib/supabase";
import Schema from "../components/seo/Schema.astro";
import Hero from "../components/ui/Hero.astro";
import Header from "../components/ui/Header.astro";

// 1. Buscar os 3 projetos mais importantes (para vitrine)
const { data: featuredProjects } = await supabase
  .from("projects")
  .select("title, slug, location, cover_image, category")
  .order("created_at", { ascending: false })
  .limit(3);

const pageTitle = "Ruth Medeiros Carvalho | Arquitetura de Alto Padrão";
const pageDesc = "Escritório de arquitetura liderado por Ruth Medeiros Carvalho. Especialista em projetos residenciais de luxo e urbanismo sustentável.";
---

<html lang="pt-br" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="description" content={pageDesc} />
    <title>{pageTitle}</title>
    
    <Schema siteTitle={pageTitle} description={pageDesc} />
    
    <ClientRouter />
  </head>
  
  <body class="bg-stone-50 text-stone-900 antialiased font-sans selection:bg-stone-900 selection:text-white">
    
    <Header />
    
    <Hero />

    <main>
      <section id="projetos" class="py-24 px-6 md:px-12 max-w-screen-2xl mx-auto">
        
        <div class="flex flex-col md:flex-row justify-between items-end mb-12 md:mb-16">
          <div>
            <h3 class="text-xs font-bold tracking-widest uppercase text-stone-500 mb-2">Portfolio</h3>
            <h2 class="text-4xl md:text-5xl font-serif text-stone-900">Obras Recentes</h2>
          </div>
          <a href="/projetos" class="hidden md:block text-sm border-b border-stone-900 pb-1 hover:text-stone-600 hover:border-stone-600 transition-colors">
            Ver todos os projetos
          </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-12">
          {featuredProjects?.map((project) => (
            <a href={`/projeto/${project.slug}`} class="group block cursor-pointer">
              <div class="overflow-hidden aspect-[4/5] bg-stone-200 mb-4 relative">
                <img 
                  src={project.cover_image || "https://placehold.co/600x800"} 
                  alt={`Projeto ${project.title} em ${project.location}`}
                  class="w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-105"
                  loading="lazy"
                  transition:name={`image-${project.slug}`} 
                />
                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-500"></div>
              </div>
              
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-xl font-serif font-medium group-hover:underline decoration-1 underline-offset-4">{project.title}</h3>
                  <p class="text-sm text-stone-500 mt-1 tracking-wide">{project.location}</p>
                </div>
                <span class="text-[10px] uppercase tracking-wider border border-stone-300 px-2 py-1 rounded-full text-stone-500">
                  {project.category}
                </span>
              </div>
            </a>
          ))}
        </div>
        
        <div class="mt-12 md:hidden text-center">
          <a href="/projetos" class="inline-block text-sm uppercase tracking-widest border-b border-stone-900 pb-1">Ver todos os projetos</a>
        </div>
      </section>
    </main>

    <footer class="bg-stone-900 text-white py-12 text-center">
      <p class="font-serif text-2xl mb-4">Ruth Medeiros Carvalho</p>
      <div class="flex justify-center gap-4 mb-8 text-xs uppercase tracking-widest text-stone-400">
        <a href="#" class="hover:text-white">Instagram</a>
        <a href="#" class="hover:text-white">LinkedIn</a>
        <a href="#" class="hover:text-white">Email</a>
      </div>
      <p class="text-stone-500 text-xs">© 2026 Todos os direitos reservados.</p>
    </footer>

  </body>
</html>